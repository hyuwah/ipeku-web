<!DOCTYPE HTML>
<html>

<head>
    <title>IPEKU Web Apps</title>
    <link type="text/css" rel="stylesheet" href="src/css/materialize.min.css">
    <link type="text/css" rel="stylesheet" href="src/css/style.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

</head>

<body>
    <header>
        <!-- <div class="row">
      <h1 class="title center-align">
        <a href="http://hyuwah.github.io" class="btn-floating btn-large waves-effect waves-light blue tooltipped hoverable" data-position="bottom" data-delay="50" data-tooltip="Go to Hyuwah's Github Page"><i class="material-icons" style="font-size:3rem;">home</i></a> IPEKU Web Apps
      </h1>
    </div> -->
        <div class="navbar-fixed">
            <nav>
                <div class="nav-wrapper blue">
                    <a href="#!" class="brand-logo center"><b>IPEKU</b> Web Apps</a>
                    <ul id="nav-mobile" class="left hide-on-med-and-down">
                        <li><a href="http://hyuwah.github.io" class="btn-floating btn-large waves-effect waves-light white tooltipped hoverable" data-position="bottom" data-delay="50" data-tooltip="Go to Hyuwah's Github Page"><i class="material-icons blue-text" style="font-size:3rem;">home</i></a></li>
                    </ul>
                </div>
                <nav id="toolbarNav">
                    <div class="nav-wrapper white">
                        <div class="row black-text">
                            <div class="col s4">
                                <h4 class="center-align flow-text" id="txttotalSKS">SKS Total: </h4></div>
                            <div class="col s4">
                                <h4 class="center-align flow-text" id="txttotalAM">Angka Mutu: </h4></div>
                            <div class="col s4">
                                <h4 class="center-align flow-text" id="txtIP">IP: </h4></div>
                        </div>
                    </div>
                </nav>
            </nav>
        </div>
    </header>

    <main class="grey lighten-4">
        <div class="container">

            <!-- Card IPEKU -->
            <div id="ipeku" class="card" style="padding:12px; margin-top:8%">

                <form id="form-matkul">
                    <div class="row">
                        <div class="input-field col s6">
                            <i class="material-icons prefix">school</i>
                            <label for="txtMatkul">Mata Kuliah</label>
                            <input class="validate" placeholder="Nama Mata Kuliah" id="txtMatkul" type="text" name="mata_kuliah" accesskey="1" />
                        </div>
                        <div class="input-field col s3">
                            <label for="txtSKS">SKS</label>
                            <input class="validate" placeholder="1-6" id="txtSKS" type="number" name="sks_kuliah" length="1" accesskey="2" />
                        </div>
                        <div class="input-field col s3">
                            <select name="hurufMutu_kuliah">
            <option value="null" disabled selected>Pilih</option>
            <option value="A" accesskey="3">A</option>
            <option value="B">B</option>
            <option value="C">C</option>
            <option value="D">D</option>
            <option value="E">E</option>
          </select>
                            <label>Huruf Mutu</label>
                        </div>
                    </div>


                    <div class="row" style="margin:0 0">

                        <div class="row">

                            <div class="col s3 m2 waves-effect waves-light blue btn" style="float:right;margin-left:8px;margin-right:8px;">

                                <input type="submit" id="matkul-op-save" value="Add" style="padding:0 33%;    line-height:inherit;" accesskey="s" />

                            </div>

                            <a class="col s3 m2 waves-effect waves-light red btn" id="matkul-op-discard" style="float:right;" accesskey="c">
            Cancel
          </a>

                        </div>

                        <!-- -->

                    </div>

                    <input type="hidden" name="id_entry" value="0" />
                </form>

                <!-- File management -->
                <div class="row" style="margin:0 0">
                  <!-- Load Data -->
                    <div class="col s6 center-align">
                        <form id="jsonFile" name="jsonFile" enctype="multipart/form-data" method="post">
                            <fieldset>
                                <div class="file-field input-field">
                                    <div class="btn blue">
                                        <span>File</span>
                                        <input type="file" id="fileinput" accept=".ip">
                                    </div>
                                    <div class="file-path-wrapper">
                                        <input class="file-path validate" type="text" placeholder="Pilih file matkul ipeku">
                                    </div>
                                </div>
                                <input type='button' id='btnLoad' value='Load Data' onclick='loadFile();' class="btn-flat blue-text waves-effect waves-grey col s12">
                            </fieldset>
                        </form>
                    </div>
                    <!-- Save Data -->
                    <div class="col s6 center-align">
                        <fieldset>
                            <div class="input-field">
                                <input placeholder="Nama File" id="txtSaveName" type="text" name="save_name" class="validate" onkeyup="stoppedTyping()"/>
                            </div>
                            <a id="saveOutput" href="#" class="btn blue-text col s12 disabled">Save Data</a>
                        </fieldset>
                    </div>
                </div>
            </div>


            <div class="card" style="padding:12px;">
                <h5 class="center-align">Daftar Mata Kuliah</h5>
                <table id="tableData" class="centered highlight">
                    <thead>
                        <tr id="matkul-head">
                            <th>No</th>
                            <th>Mata Kuliah</th>
                            <th>SKS</th>
                            <th>Huruf Mutu</th>
                            <th style="width:25%">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="matkul-table" style="cursor: pointer;">
                    </tbody>
                </table>
            </div>

        </div>
    </main>

    <!-- FAB -->
    <div class="fixed-action-btn" style="bottom: 48px; right: 5%;">
        <a id="btnReset" class="btn-floating btn-large waves-effect waves-light red tooltipped hoverable" data-position="left" data-delay="50" data-tooltip="Reset and clear all entries" accesskey="x"><i class="material-icons" style="font-size:2.5rem;">clear</i></a>
    </div>

    <footer class="page-footer blue">
        <div class="footer-copyright">
            <div class="container white-text">
                Hyuwah (c) 2016
                <a class="white-text right" href="https://github.com/hyuwah/ipeku-web">Github Repo</a>
            </div>
        </div>
    </footer>

    <!-- Modal -->
    <!-- Modal Structure -->
    <div id="mdl-rm-matkul" class="modal">
        <div class="modal-content">
            <h4>Konfirmasi</h4>
            <span id="mdl-rm-text"></span>
        </div>
        <div class="modal-footer">
            <a href="#!" class=" modal-action modal-close waves-effect waves-grey btn-flat red-text" id="mdl-rm-button">Hapus</a>
            <a href="#!" class=" modal-action modal-close waves-effect waves-grey btn-flat blue-text" id="mdl-cancel-button">Batal</a>
        </div>
    </div>

    <div id="mdl-reset" class="modal">
        <div class="modal-content">
            <h4>Konfirmasi Reset</h4>
            <span id="mdl-reset-text"></span>
        </div>
        <div class="modal-footer">
            <a href="#!" class=" modal-action modal-close waves-effect waves-grey btn-flat red-text" id="mdl-reset-yes">Hapus</a>
            <a href="#!" class=" modal-action modal-close waves-effect waves-grey btn-flat blue-text" id="mdl-reset-no">Batal</a>
        </div>
    </div>

    <script type="text/javascript" src="src/js/jquery.js"></script>
    <script type="text/javascript" src="src/js/materialize.min.js"></script>

    <script type="text/javascript" src="src/js/main.js"></script>
    <script type="text/javascript" src="src/js/jquery.tablesorter.min.js"></script>

    <script>
        //Dropdown Materialize
        $(document).ready(function() {
            $('select').material_select();
            $("#tableData").tablesorter();
        });

        $(document).ready(gpa);
        $(document).ready(function(){
          $('#saveOutput').prop('disabled',true);

        });
    </script>
    <script>
    //Cek namafile
    function stoppedTyping(){
        if(document.getElementById('txtSaveName').value.length > 0) {
            $("#saveOutput").removeClass("disabled");
            $("#saveOutput").removeClass("btn");
            $("#saveOutput").addClass("btn-flat");
            $("#saveOutput").addClass("waves-effect");
            $("#saveOutput").addClass("waves-grey");
            $("#saveOutput").attr("onClick", "saveOutput(this)");
        } else {
            $("#saveOutput").addClass("disabled");
            $("#saveOutput").addClass("btn");
            $("#saveOutput").removeClass("btn-flat");
            $("#saveOutput").removeClass("waves-effect");
            $("#saveOutput").removeClass("waves-grey");
            $("#saveOutput").removeAttr("onClick");
        }
    }
        //SAVE JSON
        function saveAsFile(link, filename) {
            if (window.localStorage.length - 1) {
                var datamatkul = [],
                    i, key;
                for (i = 0; i < window.localStorage.length; i++) {
                    key = window.localStorage.key(i);
                    if (/matkul:\d+/.test(key)) {
                        datamatkul.push(JSON.parse(window.localStorage.getItem(key)));
                    }
                }
            }
            var datasave = JSON.stringify(datamatkul);
            var blob = new Blob([datasave], {
                type: "application/json"
            });
            var url = URL.createObjectURL(blob);
            var a = link;
            a.download = filename + ".ip";
            a.href = url;
            console.log(datamatkul);
            console.log(datasave);
            location.reload();
      }

        function saveOutput(link) {
          var namaFileSave = document.getElementById('txtSaveName').value;
          if(namaFileSave != null || namaFileSave != ""){
            console.log("saveOutput clicked");
            console.log("11");
            saveAsFile(link, namaFileSave);}
            else{
              console.log("22");
              alert("Masukkan nama file terlebih dahulu");
            }
        }

        //LOAD JSON
        function loadFile() {
            var input, file, fr;

            if (typeof window.FileReader !== 'function') {
                alert("The file API isn't supported on this browser yet.");
                return;
            }

            input = document.getElementById('fileinput');
            if (!input) {
                alert("Um, couldn't find the fileinput element.");
            } else if (!input.files) {
                alert("This browser doesn't seem to support the `files` property of file inputs.");
            } else if (!input.files[0]) {
                alert("Please select a file before clicking 'Load'");
            } else {
                file = input.files[0];
                fr = new FileReader();
                fr.onload = receivedText;
                fr.readAsText(file);
            }

            function receivedText(e) {
                lines = e.target.result;
                localStorage.clear();
                var newArr = JSON.parse(lines);
                console.log(newArr);
                console.log(newArr.length);
                var i = 1;

                for (var key in newArr) {
                    // skip loop if the property is from prototype
                    if (!newArr.hasOwnProperty(key)) continue;
                    localStorage.setItem('matkul:' + i, JSON.stringify(newArr[key]));
                    console.log(key + " = " + JSON.stringify(newArr[key]));
                    i++;
                }
                localStorage.setItem('matkul:index', newArr.length + 1);
                gpa();
                location.reload();

            }
        }
    </script>
    <script>
        (function(i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function() {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-71920018-2', 'auto');
        ga('send', 'pageview');
    </script>
</body>

</html>
